From efefaf1104d786dff1704b1fef25219aa8bc6975 Mon Sep 17 00:00:00 2001
From: Stanimir Varbanov <stanimir.varbanov@linaro.org>
Date: Wed, 27 Mar 2019 13:57:27 +0200
Subject: [PATCH] v4l2: enable VP9 codec

Signed-off-by: Stanimir Varbanov <stanimir.varbanov@linaro.org>
---
 media/gpu/v4l2/v4l2_device.cc                   | 2 ++
 media/gpu/v4l2/v4l2_video_decode_accelerator.cc | 5 +----
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/media/gpu/v4l2/v4l2_device.cc b/media/gpu/v4l2/v4l2_device.cc
index c829e0cb1ef6..afaf06825bf2 100644
--- a/media/gpu/v4l2/v4l2_device.cc
+++ b/media/gpu/v4l2/v4l2_device.cc
@@ -905,6 +905,8 @@ uint32_t V4L2Device::VideoCodecProfileToV4L2PixFmt(VideoCodecProfile profile,
     return V4L2_PIX_FMT_H264;
   } else if (profile >= VP8PROFILE_MIN && profile <= VP8PROFILE_MAX) {
     return V4L2_PIX_FMT_VP8;
+  } else if (profile >= VP9PROFILE_MIN && profile <= VP9PROFILE_MAX) {
+    return V4L2_PIX_FMT_VP9;
   } else {
     LOG(FATAL) << "Add more cases as needed";
     return 0;
diff --git a/media/gpu/v4l2/v4l2_video_decode_accelerator.cc b/media/gpu/v4l2/v4l2_video_decode_accelerator.cc
index 0ae7a9a64197..72b983271233 100644
--- a/media/gpu/v4l2/v4l2_video_decode_accelerator.cc
+++ b/media/gpu/v4l2/v4l2_video_decode_accelerator.cc
@@ -80,10 +80,7 @@ size_t GetNumPlanesOfV4L2PixFmt(uint32_t pix_fmt) {
 
 // static
 const uint32_t V4L2VideoDecodeAccelerator::supported_input_fourccs_[] = {
-    V4L2_PIX_FMT_H264, V4L2_PIX_FMT_VP8,
-#if !BUILDFLAG(USE_LINUX_V4L2)
-    V4L2_PIX_FMT_VP9,
-#endif
+    V4L2_PIX_FMT_H264, V4L2_PIX_FMT_VP8, V4L2_PIX_FMT_VP9,
 };
 
 struct V4L2VideoDecodeAccelerator::BitstreamBufferRef {
-- 
2.17.1

